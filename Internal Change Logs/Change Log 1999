<change-log>
<title> The English Editor II Change Log </title>

<change-section-head> Changes </change-section-head>

<change-date> 1999.12.13 </change-date>
<change>
	Fixed MenuDirector::MakeKeyName(), which was using "key[1]" instead of "key[0]".
	Also, DOMString::operator+=(char) doesn't exist, it appends the string of the
	ASCII value instead, so I had to work around that too.  (A)
</change>


<change-date> 1999.12.12 </change-date>
<change>
	Added RequestClose() methods to DisplayDirector and WindowDirector.
</change>
<change>
	Added MessageFileSource::Trash() and System::TrashFile(), and made
	MessageFileSource::FunctionCall() handle the "Trash()" command.
</change>
<change>
	Added MenuDirector::MakeKeyName(), DoKeyAction(), and FindKeyActionIn().  Made
	KeyDown() call 'em, and made WindowDirector::KeyDown() call that.
</change>
<change>
	The above item didn't work, because the menu doesn't exist unless it's showing.
	Removed MenuDirector::DoKeyAction() and made MakeKeyName() and FindKeyActionIn()
	statics.  Changed WindowDirector::KeyDown() to handle use the 'em and handle the
	key.
</change>
<change>
	Fixed EnglishEditorWind::DispatchMessage(), which was passing the wrong "numBytes" to
	EnglishEditorView::KeyDown() when handling command-keys.  (A)
</change>


<change-date> 1999.12.11 </change-date>
<change>
	Changes to System so it sets email recipients correctly, including handling nicknames.  (A)
</change>


<change-date> 1999.11.18 </change-date>
<change>
	Fixed the MessageFileSource ctor that I changed yesterday so it doesn't try to
	mark a new message as read.  (B)
</change>


<change-date> 1999.11.17 </change-date>
<change>
	Added System::MarkMailMessageRead() and made one of the MessageFileSource ctors
	use it.  (1999.11.18.A)
</change>


<change-date> 1999.10.30 </change-date>
<change>
	Moved the code for handling placeholder text from ElementDisplayNode::Load() to
	CompositeDisplayNode::LoadFromElement().
</change>
<change>
	Added PlaceholderTextDisplayNode::ParentElementNode() and made StartSelection(),
	EndSelection() and InlineFindSelection() return it.  This allows placeholder texts
	to work correctly from within DisplayElementNodes.  Also fixed
	EmptyPlaceholderSelection::GetElement() in a similar way.
</change>
<change>
	Added RestoreEmptyPlaceholderSelectionAction::FindPlaceholder() and made Undo() use it.  (A)
</change>


<change-date> 1999.10.23 </change-date>
<change>
	BlockableDisplayNode::DisplayWidth() and DisplayLeft().  Made BlocksSelection::Bounds(),
	BlockElementSelection::HiliteBounds(), and BetweenBlocksSelection::Point() use 'em.  (A)
</change>


<change-date> 1999.10.22 </change-date>
<change>
	Added TextFileWriter::WriteRawText().
</change>
<change>
	Added MessageFileWriter::WriteRawContents() and made Write() use it for the headers.
	So headers will no longer have folding whitespace, which would have been a good thing
	except some news servers don't handle it well.  Actually, Write() doesn't use
	WriteRawContents(), since it needs to trim trailing whitespace (specifically newlines),
	so it uses DOMUtils::NodeContents() instead.  MessageFileWriter::WriteRawContents()
	will be nuked after this backup.  (A)
</change>


<change-date> 1999.10.20 </change-date>
<change>
	Added CompositeDisplayNode::LoadFromContentsTemplate(), moving the code from
	DisplayElementNode::Load().  Made ElementDisplayNode::Load() use it.  (B)
</change>


<change-date> 1999.10.19 </change-date>
<change>
	Created DisplayTextNode and DisplayElementNode.
</change>
<change>
	Added CompositeDisplayNode::LoadFromElement(), factoring code from
	ElementDisplayNode::Load().
</change>
<change>
	Added ContentsTemplateForElement() method to EditStylesheet, DOMEditStylesheet, and
	CompositeStylesheet.
</change>
<change>
	Added CompositeDisplayNode::AppendChild() and made LoadFromElement() use it.
</change>
<change>
	Made ElementDisplayNode::Load() use the contents template.
</change>
<change>
	Added IsDisposable() virtual method to DisplayNode, GeneratedLeafBlock,
	DocumentDisplayNode, TextDisplayNode, DisplayElementNode, and DisplayTextNode.
	Made CompositeDisplayNode::ClearChildren() delete the disposable children.
</change>
<change>
	Made CompositeDisplayNode dtor call ClearChildren().
</change>
<change>
	Much of the whole display-contents thing is now working.  I still need to deal
	with between-block selections.  (1999.10.20.A)
</change>


<change-date> 1999.10.18 </change-date>
<change>
	Changed WindowDirector::Draw() and MouseDown() so they'll work if there are
	no controls.
</change>
<change>
	Added WindowDirector::KillControls() and made IntroDocWind ctor call it.  (A)
</change>


<change-date> 1999.10.17 </change-date>
<change>
	Added BetweenGlyphsSelection::Promote().
</change>
<change>
	Fixed TextDisplayNode::InlineFindSelection() to it "promoteBefore" is false for
	a selection at the beginning of a word.  (1999.9.18.A)
</change>


<change-date> 1999.10.16 </change-date>
<change>
	Changes to InlineLayoutContext so it doesn't generate spurious newlines when
	a run is longer than the line length.
</change>
<change>
	Added PreSpace::IsWhitespace(), so pre-spaces are considered whitespace.
	Changed InlineLayoutContext::AddGlyph() to properly set the position of
	PreSpaces.
</change>


<change-date> 1999.10.15 </change-date>
<change>
	Made MessageFileSource::Reply() add the "to" header element to email replies.  (A)
</change>


<change-date> 1999.10.12 </change-date>
<change>
	Changed System::OpenURL() to handle URLs that begin with "URL:".  (A)
</change>
<change>
	Created PreSpace and LineBreak.
</change>
<change>
	Changed TextDisplayNode::CreateGlyphs() and AddGlyph(), and InlineLayoutContext::AddGlyph(),
	to handle preformatted spacing.
</change>
<change>
	Changed BetweenGlyphsSelection::Point() to handle LineBreaks properly.
</change>
<change>
	Changed PointSelection::HandleReturn() to just insert a return when in a "pre" section.
</change>
<change>
	Made TextDisplayNode keep its "pre-space" status.  Changes to UpdateProperties(), to
	Load(), and to InlineLayout() (to do a load if it's needed).  Made
	CompositeDisplayNode::ChildInsertedBefore() and ChildReplaced() call Load() on the child
	if it turned out to need it (because of UpdateProperties()).
</change>
<change>
	Made DisplayNode::GetPropertyInPixels() handle "sp" as a unit of measurement.
</change>
<change>
	Added TextDisplayNode::IsPreSpace() and made PointSelection::HandleReturn() use it.
</change>
<change>
	Created Tab.  Added DisplayNode::IsTab() virtual method.
</change>
<change>
	Changed TextDisplayNode::CreateGlyphs() and AddGlyph() to handle tabs in "pre" sections.
</change>
<change>
	Changed AcceptKey() methods of CharacterSelection, BetweenWordsSelection, and
	BetweenGlyphsSelection to insert a tab when the tab key is pressed in a "pre" section.  (B)
</change>


<change-date> 1999.9.28 </change-date>
<change>
	Added System::AdjustFileName().  Made MessageFileSource::Save() use it (along with other
	minor changes).  (A)
</change>
<change>
	Split XMLWriter into XMLWriter and XMLFileWriter (with appropriate change to
	XMLFileSource::Write()).  Changed it to write from an arbitrary node, not just a Document.
</change>
<change>
	Created XMLStringWriter.
</change>
<change>
	Added CanCopy() and GetXMLCopy() methods to Selection, GlyphsSelection,	
	InlineElementSelection, BlocksSelection, and BlockElementSelection.
</change>
<change>
	Added System::CopyToClipboard().
</change>
<change>
	Added DisplayDirector::CopyToClipboard(), and augmented FunctionCall().
</change>
<change>
	Made WindowDirector::KeyDown() handle control-C.  (1999.9.29.A)
</change>


<change-date> 1999.9.27 </change-date>
<change>
	Changed TextDisplayNode::InlineLayout() so it calls UpdateProperties() if necessary,
	instead of just complaining about it.
</change>
<change>
	Made CompositeDisplayNode a DOMChangeClient (and removed the direct descendancy
	from ElementDisplayNode and DocumentDisplayNode) and moved the ChildInsertedBefore(),
	ChildRemoved(), and ChildReplaced() methods there from ElementDisplayNode.
</change>
<change>
	Fixed DisplayNode::GetDisplayDirector() so it works when called on the
	DocumentDisplayNode (it starts the search with "this" instead of the parent).
</change>
<change>
	Added CompositeDisplayNode::ClearChildren(), moving the code there from
	ElementDisplayNode::Load().  Made DocumentDisplayNode::Load() call it.
</change>
<change>
	Added DocTypeChanged() virtual method to DisplayDirector and subclasses.
	Made new DocumentDisplayNode::ChildReplaced() method call it.  (A)
</change>


<change-date> 1999.9.23 </change-date>
<change>
	Made XMLWriter::WriteElement() throw a more informative exception when it
	gets a non-attribute in the attributes list.
</change>
<change>
	Made MessageFileSource::CloneNode() check its results when cloning the attributes
	of an element.  (A)
</change>
<change>
	Fixed XMLWriter::WriteElement() so the message isn't deleted before the exception
	is thrown.  It does leak memory, though.  (1999.9.24.A)
</change>
<change>
	Made System::SendMailMessage() throw an exception if the send_queued_mail() call
	fails.
</change>
<change>
	Made OSException a *public* subclass of DisplayableException.  Also made the Display()
	method show the message for the error code (from strerror()).  (1999.9.24.B)
</change>


<change-date> 1999.9.18 </change-date>
<change>
	Fixed MessageParser::Parse() to handle continuations of headers.  (B)
</change>
<change>
	Made MessageParser::HandleParas() detect signatures.
</change>
<change>
	Made MessageFileSource::Reply() and CloneNode() strip out signatures.  (C)
</change>
<change>
	Added EnglishEditorWind::SetFrame().
</change>
<change>
	Added WindowDirector::FrameChanged(), and made EnglishEditorWind::FrameChanged()
	call it.  Made SetHMargin() and SetVMargin() record changes.  Made ctor restore
	these settings.  Changed EnglishEditorWind::FrameChanged() so it no longer
	saves the window frame.  (D)
</change>
<change>
	Made WindowDirector ctor use the prefs for the margins.
</change>
<change>
	Added WindowDirector::FunctionCall(), making it implement the "SavePosition" function.  (E)
</change>
<change>
	Made WindowDirector::FrameChanged() set the "xmlns:ee2" attribute, which I forgot before.
	(1999.9.19.A)
</change>


<change-date> 1999.9.17 </change-date>
<change>
	-- The CY Project file crashed and had to be rebuilt.  This is the first crash since
	   moving this change log here, and it occurred while the system in general was acting
	   squirrelly. --
</change>
<change>
	Changed MessageParser::Parse() and MessageFileWriter::Write() to deal with
	"Message-ID" and "References" headers.
</change>
<change>
	Made MessageFileSource::Reply() compose and add the "References" header.
</change>
<change>
	Made MessageFileSource::Save() add a timestamp when generating a filename.  (A)
</change>
<change>
	Made EnglishEditorApp::WindowClosing() lock itself before calling Quit().  (B)
</change>
<change>
	Fixed MessageFileWriter::Write(), which was turning "title" elements into
	"Title:" header lines instead of "Subject:" header lines.  (C)
</change>
<change>
	Added CaretOutLeft() and CaretOutRight() methods to PointSelection, and made Draw() use them.
	Added these methods to BetweenGlyphsSelection.  (1999.9.18.A)
</change>


<change-date> 1999.9.15 </change-date>
<change>
	Added System::SendMailMessage().
</change>
<change>
	Added MessageFileSource::Send() and made FunctionCall() call it.
</change>
<change>
	Made MessageFileWriter::Write() write the "To" field, and made
	MessageParser::Parse() read it.  (A)
</change>
<change>
	Changed all the stylesheets to use Swiss Bold instead of Arial Black, since
	Arial Black doesn't come with BeOS.
</change>


<change-date> 1999.9.13 </change-date>
<change>
	Created DOMUtils.
</change>
<change>
	Made XMLFileSource::Save() handle new documents by looking for a title in the document.
	Also added "isNewDoc" default arg to the ctor.
</change>
<change>
	Made ElementDisplayNode::GetScriptProperty() handle the "contents" property.
</change>
<change>
	Made EnglishEditorApp::FunctionCall() really handle the "NewDocument" function.
</change>
<change>
	Changed IntroDocSource ctor to use the "Aux-Docs/intro-window" file.  (A)
</change>
<change>
	Added "isNewMessage" default arg to the MessageFileSource ctor.
</change>
<change>
	Made EnglishEditorApp::FunctionCall() handle the "NewMessage" function.  (B)
</change>
<change>
	Factored much of the code from the EnglishEditorWind ctor into a new Init() method.
</change>
<change>
	Wrote WindowDirector::ScreenChanged.  Made EnglishEditorWind::FrameResized() call it.  (C)
</change>
<change>
	Added no-argument ctor for EnglishEditorWind, for use by subclasses only.
</change>
<change>
	Created IntroDocWind and changed EnglishEditorApp::NewFile() to use it.
</change>
<change>
	Made IntroDocSource ctor add in the version and the build-date.  (D)
</change>
<change>
	Added Bitmap::GetColorSpace().
</change>
<change>
	Fixed WindowDirector::ScreenChanged() to use "bitmap" instead of "bitmapView" when
	getting the color space.  (E)
</change>

<change-date> 1999.9.12 </change-date>
<change>
	Created IntroDocSource.
</change>
<change>
	Made EnglishEditorApp::NewFile() show the "intro" document in an EnglishEditorWind
	instead of putting up a NewDocWind.
</change>
<change>
	Made EnglishEditorApp be a StyleScriptable, and added FunctionCall() method.
</change>
<change>
	Added System::GetApplication().
</change>
<change>
	Made ElementDisplayNode::GetScriptProperty() support the "app" property.
</change>
<change>
	Made StyleScriptable::FunctionCall() support "quote".
</change>
<change>
	Moved support for the "app" property from ElementDisplayNode to DisplayDirector.  (B)
</change>


<change-date> 1999.9.11 </change-date>
<change>
	Changed System::PostNewsMessage() to use "application/x-vnd.Folta-Item" as the
	signature of the app to launch, now that it's called "Item" rt "NNTPTest".  (A)
</change>
<change>
	Changes to InlineLayoutContext to more accurately calculate maxLineWidth:
	added "curLineWidth" ivar, setting it in FinishCurGlyphs() (only on a non-whitespace
	glyphs run); moved update of "maxLineWidth" from NewLine() and Finish() to FinishCurLine() and
	made it use "curLineWidth" instead of "curX".
</change>
<change>
	Added Glyph::AdjustX().
</change>
<change>
	Made InlineLayoutContext::FinishCurLine() handle right, center, and justify alignment.
	(Included making CompositeDisplayNode::LayoutInlineChildren() pass the alignment to
	the InlineLayoutContext ctor).  Also had to make FinishCurGlyphs() put the whitespace
	glyphs into "curLineGlyphs", since they need to be adjusted too; which meant that
	AddGlyph() had to put the whitespace glyphs into "curGlyphs".  Also had to make
	Finish() tell FinishCurLine() that it was dealing with the last line (so the last
	line doesn't get justified).  (1999.9.12.A)
</change>


<change-date> 1999.9.8 </change-date>
<change>
	Fixed GlyphsMover::ConfigureDest().  In the "begin setting up dest" section, it really
	needed to set zero-length TextSpans when "destPreGlyph" or "destPostGlyph" didn't exist.
	Otherwise, MakeAction() would get confused when setting up "selectionStart" and
	"selectionEnd".  (A)
</change>


<change-date> 1999.9.7 </change-date>
<change>
	Changed Width() methods of Word, SmartenedWord, SmartMDash, and SmartQuote
	to cache their widths.  Added UncacheWidth() virtual method to Glyph and to
	those classes (except SmartenedWord, which inherits from Word()).  Made
	TextDisplayNode::UpdateProperties() ask the glyphs to uncache their widths.
</change>
<change>
	Created MarginControl, HMarginControl, and VMarginControl.
</change>
<change>
	Added SetHMargin(), and SetVMargin() methods to WindowDirector.
</change>
<change>
	Added the margin controls to WindowDirector.
</change>
<change>
	Fixed DocumentDisplayNode::BlockLayout() and CompositeDisplayNode::LayoutChildBlocks()
	to correctly handle the "force" argument.  (A)
</change>
<change>
	Changed TagEditor so it gets passed the TagSelection instead of just the specRect,
	so Bounds() can respond to movement of the selection (eg. during changed of the h-margin).
	Changed TagSelection::ShowTag() accordingly.
</change>
<change>
	Changed DisplayDirector::MouseDown() so it calls Selection::ContainsPoint() instead
	of just checking against the selection's Bounds().  Added
	GlyphsSelection::ContainsPoint(), so it doesn't use Selection's default, which also
	just checks the bounds.
</change>
<change>
	Fixed GlyphsHilite::ContainsPoint(), which was getting "firstLine" wrong (it always
	thought it was the same as "lastLine").  (B)
</change>


<change-date> 1999.9.6 </change-date>
<change>
	Experimental switch to the Unified DOM classes.  Changes to
	DisplayDirector::DisplayNodeFor(), DocumentDisplayNode,
	ElementDisplayNode, TextDisplayNode, PlaceholderTextDisplayNode, XMLFileSource,
	MessageFileSource, and TagDocumentSource.  This didn't help the Constitution open
	speed at all, but I'm gonna leave them in for a couple days just to see how it works,
	esp. in terms of debugging.  The .A project file is pre-switch.
</change>
<change>
	Changed the following so they no longer use DOMStringSliceIter: DisplayNode::GetFont(),
	and ElementDisplayNode ctor.  (A)
</change>
<change>
	Tried changing InlineLayoutContext to use qvectors instead of vectors, but it didn't
	help the Constitution open time.
</change>
<change>
	Made Glyph::SetPosition() inline.
</change>
<change>
	Added Font::SpaceWidth(), making the ctor set the associated ivar.  Made Space::Width()
	use it.  Yes!  Finally something made a difference--Constitution now opens in 2.6
	seconds!  (B)
</change>
<change>
	Changed InlineLayoutContext back to using a vector instead of a qvector, since there seems
	to be something wrong with qvector, even though I can't find the bug.  (C)
</change>
<change>
	Added CurFont() virtual method to DisplayNode, GeneratedLeafBlock, DocumentDisplayNode,
	and ElementDisplayNode.  Made DisplayNode::GetPropertyInPixels() use it.  This provided
	a slight improvement--Constitution now opens in 2.4 seconds.  (D)
</change>


<change-date> 1999.9.5 </change-date>
<change>
	Changed TextDisplayNode::GetText() to return a Text instead of a LiveText, so
	BetweenGlyphsSelection, BetweenWordsSelection, CompositeDisplayNode,
	GeneratedLeafBlock, GlyphsMover, GlyphsSelection, PointSelection,
	RestoreGlyphsSelectionAction, SmartMDash, SmartQuote, Space, TextSpan, Word,
	and CharacterSelection only have to know about Text, not LiveText.  Minor changes
	to CharacterSelection::AcceptKey(), and to RestoreGlyphsSelectionAction ivars.
</change>
<change>
	Changed DocumentDisplayNode::Load() so it no longer unnecessarily casts the
	DocumentElement to a DOMLiveNode.  (A)
</change>


<change-date> 1999.9.4 </change-date>
<change>
	Made MessageFileSource::Save() add in the date.
</change>
<change>
	Created MergeElementsAction, and made BetweenGlyphsSelection::AcceptKey()
	use it when appropriate.
</change>
<change>
	Added PointSelection::IsInFirstTextOfBlock().
</change>
<change>
	Added MergedElementsAction::IsValid(), and made ctor kick out when not valid.
	Made BetweenGlyphsSelection::AcceptKey() check for validity before trying to
	do the action.
</change>
<change>
	Changed CompositeDisplayNode::FindDestinationInChildBlocks() to explicitly
	return the destination when it's after a child block, instead of just falling
	thru like it did before to let the next loop iteration handle it.  I did this
	because for the last child block there *is* no next loop iteration.  (A)
</change>
<change>
	Changes to InlineLayoutContext to line up baselines.
</change>
<change>
	Added Glyph::AdjustY().  (B)
</change>
<change>
	Changed ElementDisplayNode::Load() so it always generates TextDisplayNodes, even for
	ignorable whitespace, and changed CompositeDisplayNode::CheckIfBlock() to
	strip out ignorable whitespace TextDisplayNodes.
</change>
<change>
	Made DisplayNode's dtor virtual.  (C)
</change>


<change-date> 1999.9.3 </change-date>
<change>
	Added PointSelection::HandleReturn() and made AcceptKey() methods of
	CharacterSelection, BetweenGlyphsSelection, and BetweenWordsSelection
	use it instead of doing it themselves.
</change>
<change>
	Made PointSelection::HandleReturn() deal correctly with splits at the end of an inner
	element.  Made it handle the &quot;special-split&quot; property.
</change>
<change>
	Changed NewLeafBlockAction ctor to take a &quot;tagName&quot; argument (with a default).  Made
	PointSelection::HandleReturn() pass it.
</change>
<change>
	Fixed TextDisplayNode::AddGlyph() so it doesn&apos;t add a whitespace glyph at the beginning
	of the Text.  Then changed it back, because while it works great at the beginning
	of a block, it&apos;s all wrong inside a block.  I&apos;ll have to think about this a bit...  (A)
</change>
<change>
	Cleaned up PointSelection::HandleReturn(), removing code that was never called.  (B)
</change>


<change-date> 1999.9.2 </change-date>
<change>
	Created SplitTextAction.
</change>
<change>
	Changed BetweenGlyphsSelection::AcceptKey() to split paragraphs. (A)
</change>
<change>
	Changed the AcceptKey() methods of BetweenWordsSelection and CharacterSelection to
	split paragraphs. (B)
</change>



</change-log>